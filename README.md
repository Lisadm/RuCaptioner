# RuCaptioner

**Менеджер датасетов с ИИ для тренировки LORA** - Настольное приложение для подготовки качественных датасетов изображений с автоматической генерацией описаний (капшнов), разработанное специально для тренировки LORA и файн-тюнинга нейросетей.

![Скриншот RuCaptioner](documentation/screenshots/screenshot1.png)
*Интерфейс редактирования описаний с генерацией на базе ИИ, оценкой качества и пакетной обработкой*

## Что такое RuCaptioner?

RuCaptioner упрощает утомительный процесс подготовки датасетов для обучения ИИ. Вместо того чтобы вручную подписывать сотни картинок, вы можете:

1. **Организовать** изображения по папкам с помощью Drag-and-Drop
2. **Автоматически описать** весь датасет, используя локальные Vision-модели (через LM Studio)
3. **Проверить и отредактировать** описания с подсказками и оценкой качества
4. **Экспортировать** идеально отформатированный датасет, готовый к обучению (Kohya_ss, OneTrainer и др.)

Весь процесс происходит локально на вашем компьютере - никаких облаков, платных API и полная приватность.

## Ключевые возможности

- **Отслеживание папок** - Работайте с локальными папками, просто перетащив их в приложение
- **Умная галерея** - Быстрая сетка миниатюр с lazy-loading и WebP сжатием
- **Управление датасетами** - Группируйте изображения в именованные наборы
- **Гибкие шаблоны описаний** - Выбирайте стиль: теги (Danbooru), естественный язык или детальное описание
- **Seed Management** - Фиксируйте сид для воспроизводимых экспериментов с промптами
- **ИИ Авто-капшнинг** - Генерация описаний через локальные модели (Qwen, LLaVA) в LM Studio
- **Встроенный переводчик** - Переводите описания на нужный язык прямо в редакторе
- **Оценка качества** - Автоматическая пометка проблемных описаний
- **Ручное редактирование** - Кликните на любое фото для быстрого исправления текста
- **Умный Экспорт** - Последовательная нумерация файлов, конвертация форматов, очистка метаданных
- **Настольное приложение** - Нативный интерфейс на базе Electron

## Требования

- **Python 3.10+** - [Скачать](https://python.org)
- **Node.js 18+** - [Скачать](https://nodejs.org)
- **LM Studio** - Запущенный в режиме сервера с загруженной Vision-моделью (например, Qwen2.5-VL)

> **Новичок?** Читайте [QUICKSTART.md](QUICKSTART.md) для пошаговой инструкции по установке.

## Установка

### Windows

```batch
install.bat
```

### Linux/macOS

```bash
chmod +x install.sh
./install.sh
```

Установщик автоматически создаст виртуальное окружение Python (venv) и установит все необходимые зависимости.

## Запуск

### Windows

```batch
start.bat
```

### Linux/macOS

```bash
./start.sh
```

Это запустит:
1. Сервер бэкенда на Python (порт 8675)
2. Приложение Electron (интерфейс)

## Неразрушающий дизайн

**RuCaptioner никогда не меняет ваши оригинальные файлы.** Все операции на 100% безопасны:

- ✅ **Отслеживание папок** только читает файлы - никогда не пишет в них
- ✅ **Миниатюры** хранятся отдельно в кэше (`data/thumbnails/`)
- ✅ **Описания** хранятся в базе данных SQLite. Ваша коллекция txt-файлов затрагивается только при экспорте (в отдельную папку)
- ✅ **Экспорт** копирует файлы в новое место - исходники остаются нетронутыми

Экспериментируйте смело - ваши исходные данные в безопасности.

## Конфигурация

Настройки хранятся в `config/settings.yaml`:

```yaml
vision:
  backend: lmstudio
  lmstudio_url: http://localhost:1234
  default_model: qwen/qwen2.5-vl-7b
  max_tokens: 4096             # Важно для подробных описаний
  timeout_seconds: 120

thumbnails:
  max_size: 256
  quality: 85
  format: webp

export:
  default_format: jpeg
  default_quality: 95
  default_padding: 6           # Количество цифр в имени файла (000001.jpg)
```

## Структура проекта

```
RuCaptioner/
 electron/           # Electron (интерфейс)
    main.js         # Точка входа, запускает Python
 backend/            # Python FastAPI бэкенд
    api/            # API эндпоинты
    services/       # Логика приложения
    models.py       # Модели базы данных (SQLAlchemy)
 frontend/           # Веб-интерфейс
    css/styles.css  # Стили
    js/             # Логика интерфейса
    index.html      # Главная страница
 config/             # Конфигурация
 data/               # Хранилище данных (БД, кэш)
 install.bat/.sh     # Скрипты установки
 start.bat/.sh       # Скрипты запуска
```

## Разработка

### Запуск с DevTools

```bash
npm run dev
```

### Документация API

После запуска приложения доступна интерактивная документация Swagger по адресу: `http://localhost:8675/docs`

## Решение проблем

### "No vision models available"

Убедитесь, что LM Studio запущен в режиме **Server** (зеленая кнопка Start Server) и в нем загружена модель с поддержкой зрения (Vision), например Qwen2.5-VL.

### Описания обрываются

Увеличьте параметр `max_tokens` в файле `config/settings.yaml`. Современные модели могут писать очень длинные тексты.

### Программа не закрывается полностью

В последних версиях мы добавили **Graceful Shutdown**. Если процесс все же висит, используйте `taskkill` или диспетчер задач, но обычно приложение само убивает все свои дочерние процессы.

## Лицензия

Apache 2.0 - См. файл [LICENSE](LICENSE).

## Ссылки

- [QUICKSTART.md](QUICKSTART.md) - Быстрый старт и инструкция
- [API Documentation](http://localhost:8675/docs) - Документация API

## Поддержать автора

[![ko-fi](https://ko-fi.com/img/githubbutton_sm.svg)](https://ko-fi.com/C0C31T80OE)